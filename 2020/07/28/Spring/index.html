

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="spring简介什么是springSpring是分层的Java SE/EE应用full stack轻量级开源框架,以IoC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核。
提供了展现层SpringMVC和持久层Spring JDBCTemplate以及业务层事务管理等众多的企业级应用技术,还能整合开源世界众多">
  <meta name="author" content="Leon Wang">
  <meta name="keywords" content="">
  <meta name="description" content="spring简介什么是springSpring是分层的Java SE&#x2F;EE应用full stack轻量级开源框架,以IoC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核。 提供了展现层SpringMVC和持久层Spring JDBCTemplate以及业务层事务管理等众多的企业级应用技术,还能整合开源世界众多">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://rainbowcat.top/2020/07/28/Spring/index.html">
<meta property="og:site_name" content="Leon&#39;s blog">
<meta property="og:description" content="spring简介什么是springSpring是分层的Java SE&#x2F;EE应用full stack轻量级开源框架,以IoC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核。 提供了展现层SpringMVC和持久层Spring JDBCTemplate以及业务层事务管理等众多的企业级应用技术,还能整合开源世界众多">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-28T06:01:26.000Z">
<meta property="article:modified_time" content="2020-10-17T07:56:28.905Z">
<meta property="article:author" content="Leon Wang">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary_large_image">
  
  <title>Spring - Leon&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rainbowcat.top","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>CodeWang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Spring">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-07-28 14:01" pubdate>
        2020年7月28日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      33k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      41 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：1 年前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="spring简介"><a href="#spring简介" class="headerlink" title="spring简介"></a>spring简介</h1><h2 id="什么是spring"><a href="#什么是spring" class="headerlink" title="什么是spring"></a>什么是spring</h2><p>Spring是分层的Java SE/EE应用full stack轻量级开源框架,以IoC(Inverse Of Control:反转控制)和AOP(Aspect Oriented Programming:面向切面编程)为内核。</p>
<p>提供了<strong>展现层SpringMVC</strong>和<strong>持久层Spring JDBCTemplate</strong>以及<strong>业务层事务管理</strong>等众多的企业级应用技术,还能整合开源世界众多著名的第三方框架和类库,逐渐成为使用最多的Java EE企业应用开源框架。</p>
<a id="more"></a>

<h2 id="spring的优势"><a href="#spring的优势" class="headerlink" title="spring的优势"></a>spring的优势</h2><ol>
<li>方便解耦，简化开发<br>通过Spring提供的IoC容器，可以将对象间的依赖关系交由Spring进行控制，避免硬编码所造成的过度耦合。用户也不必再为单例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。</li>
<li>AOP编程的支持<br>通过Spring的AOP功能，方便进行面向切面编程,许多不容易用传统OOP实现的功能可以通过AOP轻松实现。</li>
<li>声明式事务的支持<br>可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务管理,提高开发效率和质量。</li>
<li>方便程序的测试<br>可以用非容器依赖的编程方式进行几乎所有的测试工作,测试不再是昂贵的操作，而是随手可做的事情。</li>
<li>方便集成各种优秀框架<br>Spring对各种优秀框架(Struts、Hibermate、Hessian、Quartz等) 的支持。</li>
<li>降低JavaEE API的使用难度<br>Spring对JavaEE API (如JDBC、JavaMail、 远程调用等)进行了薄薄的封装层，使这些API的使用难度大为降低。</li>
<li>Java源码是经典学习范例<br>Spring的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对Java设计模式灵活运用以及对Java技术的高深造诣。它的源代码无意是Java技术的最佳实践的范例。</li>
</ol>
<h2 id="spring的体系结构"><a href="#spring的体系结构" class="headerlink" title="spring的体系结构"></a>spring的体系结构</h2><h4 id="Core-Container"><a href="#Core-Container" class="headerlink" title="Core Container"></a>Core Container</h4><ol>
<li>Beans</li>
<li>Core</li>
<li>Context</li>
<li>SpEl</li>
</ol>
<h4 id="AOP-Aspects-instrumentation-Messaging"><a href="#AOP-Aspects-instrumentation-Messaging" class="headerlink" title="AOP Aspects instrumentation Messaging"></a>AOP Aspects instrumentation Messaging</h4><h4 id=""><a href="#" class="headerlink" title=""></a></h4><ol>
<li>Data Access/instrumentation<ul>
<li>JDBC</li>
<li>ORM</li>
<li>OXM</li>
<li>JMS</li>
<li>Transactions</li>
</ul>
</li>
<li>Web<ul>
<li>WebStocket</li>
<li>Servlet</li>
<li>Web</li>
<li>Portlet</li>
</ul>
</li>
</ol>
<h2 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h2><ol>
<li>Spring程序开发步骤<br>①导入Spring开发的基本包坐标<br>②编写Dao接口和实现类<br>③创建Spring核心配置文件<br>④在Spring配置文件中配置UserDaolmpl<br>⑤使用Spring的API获得Bean实例</li>
</ol>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>需要在resources目录下创建配置文件（一般为applicationContext.xml），使用Bren标签进行配置（无参构造）。</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"useDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.UserDaoImpl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>调用时，从spring的客户端中使用getBean方法获取</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">ApplicationContext app = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"applicationContext.xml"</span>);<br>UserDao userDao = (UserDao) app.getBean(<span class="hljs-string">"userDao"</span>);<br></code></pre></div></td></tr></table></figure>
<h4 id="Bean标签范围配置"><a href="#Bean标签范围配置" class="headerlink" title="Bean标签范围配置"></a>Bean标签范围配置</h4><p>cope：指对象的作用范围，取值如下：</p>
<table >
    <tr>
    <th>取值范围</th>
    <th>说明</th>
    </tr>
    <tr>
    <td align="center">singleton</td>
    <td  align="center">默认值，单例的（容器中只存在一个对象）<br>①在应用加载，创建容器时创建对象<br>②只要容器在，对象就一直活着<br>③当应用卸载，销毁容器时对象被销毁</td>
    </tr>
    <tr>
    <td align="center">prototype</td>
    <td  align="center">多例的<br>①当使用（getBean）对象时创建<br>②只要对象在使用中，就一直活着<br>③当对象长时间不用，会被Java的垃圾回收器回收</td>
    </tr>
    <tr>
    <td align="center">request</td>
    <td  align="center">WEB项目中，Spring创建的一个Bean对象，将对象存入request域中</td>
    </tr>
    <tr>
    <td align="center">session</td>
    <td  align="center">WEB项目中，Spring创建的一个Bean对象，将对象存入session域中</td>
    </tr>
    <tr>
    <td align="center">global session</td>
    <td  align="center">WEB项目中，应用在Portlet环境，<br>如果没有Portlet环境那么globalSession相当于session</td>
    </tr>
</table>

<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">bean id="useDao" class="top.rainbowcat.dao.Impl.UserDaoImpl" scope="singleton"&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h4 id="Bean生命周期配置"><a href="#Bean生命周期配置" class="headerlink" title="Bean生命周期配置"></a>Bean生命周期配置</h4><p>init-method：指定类中的初始化方法名称<br>destroy-method：指定类中的销毁方法名称</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">bean id="useDao" class="top.rainbowcat.dao.Impl.UserDaoImpl" init-method="接口中的方法"&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h4 id="Bean实例化三种方式"><a href="#Bean实例化三种方式" class="headerlink" title="Bean实例化三种方式"></a>Bean实例化三种方式</h4><ul>
<li>无参构造方法实例化</li>
</ul>
<blockquote>
<p>bean id=”useDao” class=”top.rainbowcat.dao.Impl.UserDaoImpl”&gt;</bean></p>
</blockquote>
<ul>
<li>工厂静态方法实例化</li>
</ul>
<blockquote>
<p>bean id=”useDao” class=”top.rainbowcat.factory.StaticFactory” factory-method=”getUserDao”&gt;</bean></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StaticFactory</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserDao <span class="hljs-title">getUserDao</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDaoImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>工厂实例方法实例化</li>
</ul>
<blockquote>
<p>bean id=”factory” class=”top.rainbowcat.factory.DynamicFactory”&gt;</bean><br>bean id=”useDao” factory-bean=”factory” factory-method=”getUserDao”&gt;</bean></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicFactory</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDao <span class="hljs-title">getUserDao</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDaoImpl();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h4 id="Bean的依赖注入"><a href="#Bean的依赖注入" class="headerlink" title="Bean的依赖注入"></a>Bean的依赖注入</h4><p>因为UserService和UserDao都在Spring容器中，而最终程序直接使用的是UserService,所以可以在Spring容器中，将UserDao设置到UserService内部。</p>
<ol>
<li>Bean的依赖注入概念<br>依赖注入(Dependency Injection) :它是Spring框架核心IOC的具体实现。<br>在编写程序时，通过控制反转，把对象的创建交给了Spring, 但是代码中不可能出现没有依赖的情况。<br>I0C解耦只是降低他们的依赖关系，但不会消除。例如:业务层仍会调用持久层的方法。<br>那这种业务层和持久层的依赖关系,在使用Spring之后,就让Spring来维护了。<br>简单的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取。</li>
<li>Bean的依赖注入方式</li>
</ol>
<ul>
<li>set方法<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserDao</span><span class="hljs-params">(UserDao userDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userDao = userDao;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.UserDaoImpl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.service.Impl.UserServiceImpl"</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--name是service当中的set方法的属性--&gt;</span><br>    <span class="hljs-comment">&lt;!--ref是容器当中的id值,代表对象引用（注入普通数据类型时不能使用）--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userDao"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
外部程序在使用service的时候，要使用容器当中的才能正常调用dao层。直接new出来的service对象，无法获取到容器当中注入给service的dao对象。<br></li>
</ul>
<p><strong>P命名空间注入：</strong>本质上也是set方法注入，但比上述set方法注入更加方便（主要体现在配置文件中）。</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--首先引入P命名空间--&gt;</span><br>xmlns:p="http://www.springframework.org/schema/p"<br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.UserDaoImpl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.service.Impl.UserServiceImpl"</span> <span class="hljs-attr">p:userDao-ref</span>=<span class="hljs-string">"userDao"</span> /&gt;</span><br></code></pre></div></td></tr></table></figure>
<ul>
<li>构造方法<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-comment">//有参构造</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserServiceImpl</span><span class="hljs-params">(UserDao userDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userDao = userDao;<br>    &#125;<br><br>    <span class="hljs-comment">//无参构造</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserServiceImpl</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.UserDaoImpl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.service.Impl.UserServiceImpl"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userDao"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

</li>
</ul>
<h4 id="Bean的依赖注入的数据类型"><a href="#Bean的依赖注入的数据类型" class="headerlink" title="Bean的依赖注入的数据类型"></a>Bean的依赖注入的数据类型</h4><p>上面的操作，都是注入的引用Bean,除了对象的引用可以注入，普通数据类型，集合等都可以在容器中进行注入。<br><br>注入数据的三种数据类型：</p>
<ul>
<li>普通数据类型</li>
<li>引用数据类型</li>
<li>集合数据类型</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.UserDaoImpl"</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--注入普通数据类型--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"lisi"</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!--注入集合数据类型--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user1"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.domain.User"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userMap"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"u1"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"user1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h4 id="引入其他配置文件（分模块开发）"><a href="#引入其他配置文件（分模块开发）" class="headerlink" title="引入其他配置文件（分模块开发）"></a>引入其他配置文件（分模块开发）</h4><p>实际开发中，Spring的配置内容非常多,这就导致Spring配置很繁杂且体积很大,所以，可以将部分配置拆解到其他配置文件中，而在Spring主配置文件通过import标签进行加载</p>
<blockquote>
<import resource="applicationContext-xxx.xml"/>
</blockquote>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p><strong>Spring的重要配置</strong></p>
<ol>
<li><p><code>&lt;bean&gt;</code>标签</p>
<ul>
<li>id属性:在容器中Bean实例的唯一标识， 不允许重复</li>
<li>class属性:要实例化的Bean的全限定名</li>
<li>scope属性:Bean的作用范围，常用是Singleton (默认)和prototype</li>
</ul>
</li>
<li><p><code>&lt;property&gt;</code>标签:属性注入</p>
<ul>
<li>name属性:属性名称</li>
<li>value属性:注入的普通属性值</li>
<li>ref属性:注入的对象引用值</li>
</ul>
</li>
<li><p><code>&lt;list&gt;</code>标签</p>
</li>
<li><p><code>&lt;map&gt;</code>标签</p>
</li>
<li><p><code>&lt;properties&gt;</code>标签</p>
</li>
<li><p><code>&lt;constructor-arg&gt;</code>标签</p>
</li>
<li><p><code>&lt;import&gt;</code>标签:导入其他的Spring的分文件</p>
</li>
</ol>
<h1 id="Spring的相关API"><a href="#Spring的相关API" class="headerlink" title="Spring的相关API"></a>Spring的相关API</h1><h2 id="ApplicationContext的实现类"><a href="#ApplicationContext的实现类" class="headerlink" title="ApplicationContext的实现类"></a>ApplicationContext的实现类</h2><ol>
<li>ClassPathXmlApplicationContext<br>它是从类的根路径下加载配置文件推荐使用这种。</li>
<li>FileSystemXmlApplicationContext<br>它是从磁盘路径.上加载配置文件，配置文件可以在磁盘的任意位置。</li>
<li>AnnotationConfigApplicationContext<br>当使用注解配置容器对象时，需要使用此类来创建spring容器。它用来读取注解。</li>
</ol>
<h2 id="getBean-方法使用"><a href="#getBean-方法使用" class="headerlink" title="getBean()方法使用"></a>getBean()方法使用</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> object <span class="hljs-title">getBean</span> <span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>    assertBeanFactoryActive() ;<br>    &lt;!--例如：getBean(<span class="hljs-string">"UserService"</span>)--&gt;<br>    <span class="hljs-keyword">return</span> getBeanFactory() .getBean(name) ;<br></code></pre></div></td></tr></table></figure>
<p>此类方法时通过id获取，允许容器中有多个相同类型的对象。当容器中某一类型的对象只有一个时，才可以使用下面的方式。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123; <br>    assertBeanFactoryLstive() ;<br>    &lt;!--例如：getBean(UserService<span class="hljs-class">.<span class="hljs-keyword">class</span>)--&gt;<br>    <span class="hljs-title">return</span> <span class="hljs-title">getBeanFactory</span>().<span class="hljs-title">getBean</span>(<span class="hljs-title">requiredType</span>) </span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="Spring配置数据源（连接池）"><a href="#Spring配置数据源（连接池）" class="headerlink" title="Spring配置数据源（连接池）"></a>Spring配置数据源（连接池）</h1><h2 id="数据源（连接池）的作用"><a href="#数据源（连接池）的作用" class="headerlink" title="数据源（连接池）的作用"></a>数据源（连接池）的作用</h2><ul>
<li>数据源(连接池)是提高程序性能如出现的</li>
<li>事先实例化数据源，初始化部分连接资源</li>
<li>使用连接资源时从数据源中获取</li>
<li>使用完毕后将连接资源归还给数据源</li>
</ul>
<h1 id="Spring注解"><a href="#Spring注解" class="headerlink" title="Spring注解"></a>Spring注解</h1><h2 id="原始注解"><a href="#原始注解" class="headerlink" title="原始注解"></a>原始注解</h2><table>
    <tr>
        <th>注解</th>
        <th>说明</th>
    </tr>
    <tr>
        <td  align="center">@Component</td>
        <td  align="center">使用在类上用于实例化Bean</td>
    </tr>
    <tr>
        <td  align="center">@Controller</td>
        <td  align="center">使用在web层类上用于实例化Bean</td>
    </tr>
    <tr>
        <td  align="center">@Service</td>
        <td  align="center">使用在service层类上用于实例化Bean</td>
    </tr>
    <tr>
        <td  align="center">@Repository</td>
        <td  align="center">使用在dao层类上用于实例化Bean</td>
    </tr>
    <tr>
        <td  align="center">@Autowired</td>
        <td  align="center">使用在字段上用于根据类型依赖注入</td>
    </tr>
    <tr>
        <td  align="center">@Qualifier</td>
        <td  align="center">结合@Autowired-起使用用于根据名称进行依赖注入</td>
    </tr>
    <tr>
        <td  align="center">@Resource</td>
        <td  align="center">相当于@Autowired+@Qualifier,按照名称进行注入</td>
    </tr>
    <tr>
        <td  align="center">@Value</td>
        <td  align="center">注入普通属性</td>
    </tr>
    <tr>
        <td  align="center">@Scope</td>
        <td  align="center">标注Bean的作用范围</td>
    </tr>
    <tr>
        <td  align="center">@PostConstruct</td>
        <td  align="center">使用在方法上标注该方法是Bean的初始化方法</td>
    </tr>
    <tr>
        <td  align="center">@PreDestroy</td>
        <td  align="center">使用在方法 上标注该方法是Bean的销毁方法</td>
    </tr>
</table>
使用注解进行开发时，需要在applicationC ontext.xml中配置组件扫描,作用是指定哪个包及其子包下的Bean
需要进行扫描以便识别使用注解配置的类、字段和方法。
<--注解的组件扫描- >
> <context:component-scan base-package ="top.rainbowcat"></context:component-scan>

<p><strong>示例:</strong><br></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span><br>       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<br>       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  配置组件扫描  --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"top.rainbowcat"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span>(<span class="hljs-string">"userDao"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">"save..."</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><br><span class="hljs-meta">@Service</span>(<span class="hljs-string">"userService"</span>)  <span class="hljs-comment">//配置注解</span><br><span class="hljs-meta">@Scope</span>(<span class="hljs-string">"prototype"</span>)  <span class="hljs-comment">//设置作用域</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-meta">@Autowired</span>  <span class="hljs-comment">//按照类型注入可以省去@Qualifier("userDao")</span><br>    <span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"userDao"</span>)  <span class="hljs-comment">//按照id值去匹配,要结合@Autowired使用</span><br>    <span class="hljs-comment">//@Resource(name="userDao"),相当于@Autowired + @Qualifier("userDao")</span><br>    <span class="hljs-comment">//在使用注解进行注入时,set方法可以省去</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserDao</span><span class="hljs-params">(UserDao userDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userDao = userDao;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>用注解注入普通数据,可以从容器中获取键值对的数据进行注入:</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;jdbc.driver&#125;"</span>)<br><span class="hljs-keyword">private</span> String driver;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>&#123;<br>    System.out.println(driver);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="新注解"><a href="#新注解" class="headerlink" title="新注解"></a>新注解</h2><p>使用上面的注解还不能全部替代xml配置文件,还需要使用注解替代的配置如下: </p>
<ul>
<li>非自定义的Bean的配置: <code>&lt;bean&gt;</code></li>
<li>加载properties文件的配置: <code>&lt;context:property-placeholder&gt;</code></li>
<li>组件扫描的配置: <code>&lt;context:component-scan&gt;</code></li>
<li>引入其他文件: <code>&lt;import&gt;</code></li>
</ul>
<table>
    <tr>
        <th>注解</th>
        <th>说明</th>
    </tr>
    <tr>
        <td  align="center">@Configuration</td>
        <td  align="center">用于指定当前类是一个Spring配置类，当创建容器时会从该类上加载注解</td>
    </tr>
    <tr>
        <td  align="center">@ComponentScan</td>
        <td  align="center">用于指定Spring在初始化容器时要扫描的包。<br>
            作用和在Spring的xml配置文件中的
            <context:component-scan base package= "top.rainbowcat"/>-样</td>
    </tr>
    <tr>
        <td  align="center">@Bean</td>
        <td  align="center">使用在方法上，标注将该方法的返回值存储到Spring容器中</td>
    </tr>
    <tr>
        <td  align="center">@PropertySource</td>
        <td  align="center">用于加载.properties文件中的配置</td>
    </tr>
    <tr>
        <td  align="center">@Import</td>
        <td  align="center">用于导入其他配置类</td>
    </tr>
</table>
**示例:**
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span>(<span class="hljs-string">"userDao"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">"save..."</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>(<span class="hljs-string">"userService"</span>)  <span class="hljs-comment">//service的注解</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">"userDao"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserDao</span><span class="hljs-params">(UserDao userDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userDao = userDao;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br> * Spring核心配置类<br> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-comment">//&lt;!--  配置组件扫描  --&gt;</span><br><span class="hljs-comment">//&lt;context:component-scan base-package="top.rainbowcat"&gt;&lt;/context:component-scan&gt;</span><br><span class="hljs-meta">@ComponentScan</span>(<span class="hljs-string">"top.rainbowcat"</span>)  <span class="hljs-comment">//配置组件扫描</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringConfiguration</span> </span>&#123;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//从配置文件加载</span><br><span class="hljs-comment">//&lt;context:property-placeholder location="classpath:jdbc.properties"&gt;&lt;/context:property-placeholder&gt;</span><br><span class="hljs-meta">@PropertySource</span>(<span class="hljs-string">"classpath:jdbc.properties"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSoueceConfiguration</span> </span>&#123;<br><br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;jdbc.drive&#125;"</span>)<br>    <span class="hljs-keyword">private</span> String driver;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;jdbc.url&#125;"</span>)<br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;jdbc.username&#125;"</span>)<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;jdbc.password&#125;"</span>)<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Bean</span>(<span class="hljs-string">"dataSource"</span>)  <span class="hljs-comment">//对方法添加注解</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">getDataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        DruidDataSource dataSource = <span class="hljs-keyword">new</span> DruidDataSource();<br>        dataSource.setDriverClassName(driver);<br>        dataSource.setUrl(url);<br>        dataSource.setUsername(username);<br>        dataSource.setPassword(password);<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="Spring集成Junit"><a href="#Spring集成Junit" class="headerlink" title="Spring集成Junit"></a>Spring集成Junit</h2><p>让SpringJunit负责创建Spring容器,但是需要将配置文件的名称告诉它。<br><br>将需要进行测试Bean直接在测试类中进行注入。</p>
<h4 id="Spring集成Junit的步骤"><a href="#Spring集成Junit的步骤" class="headerlink" title="Spring集成Junit的步骤"></a>Spring集成Junit的步骤</h4><ul>
<li>导入spring集成Junit的坐标</li>
<li>使用@Runwi th注解替换原来的运行期</li>
<li>使用@ContextConfiguration指定配置文件或配置类</li>
<li>使用@Autowi red注入需要测试的对象</li>
<li>创建测试方法进行测试</li>
</ul>
<p><strong>pom.xml导入Junit坐标:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>将测试类中的代码进行修改:</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//指定测试内核</span><br><span class="hljs-meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)<br>//指定配置文件<br>@<span class="hljs-title">ContextConfiguration</span>(<span class="hljs-title">classes</span> </span>= &#123;SpringConfiguration<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">DataSourceConfiguration</span>.<span class="hljs-title">class</span>&#125;)<br><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">SpringTest</span> </span>&#123;<br>    <span class="hljs-comment">//需要测试哪个,直接注入即可</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        userService.save();<br>        System.out.println(dataSource.getConnection());<br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="Spring的AOP"><a href="#Spring的AOP" class="headerlink" title="Spring的AOP"></a>Spring的AOP</h1><h2 id="什么是AOP"><a href="#什么是AOP" class="headerlink" title="什么是AOP"></a>什么是AOP</h2><p>AOP为Aspect Oriented Programming的缩写,意思为面向切面编程,是通过预编译方式和运行期动态代理实现程序功能的统-维护的一种技术。<br><br>AOP是OOP（面向对象编程）的延续,是软件开发中的一个热点,也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离,从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。<br></p>
<h2 id="AOP的作用及其优势"><a href="#AOP的作用及其优势" class="headerlink" title="AOP的作用及其优势"></a>AOP的作用及其优势</h2><ul>
<li>作用：在程序运行期间，在不修改源码的情况下对方法进行功能增强。</li>
<li>优势：减少代码复用，提高开发效率，并且便于维护。</li>
</ul>
<h2 id="AOP的底层实现"><a href="#AOP的底层实现" class="headerlink" title="AOP的底层实现"></a>AOP的底层实现</h2><p>实际上，AOP的底层是通过Spring提供的的动态代理技术实现的。在运行期间，Spring通过动态代理技术动态的生成代理对象，代理对象方法执行时进行增强功能的介入，在去调用目标对象的方法，从而完成功能的增强。</p>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><ol>
<li>动态代理有什么作用及应用场景?<ul>
<li>日志集中打印</li>
<li>事务</li>
<li>权限管理</li>
<li>AOP</li>
</ul>
</li>
</ol>
<p>2.在Spring Aop当中可以哪些方式实现，及区别?<br>    - java Proxy(动态构建字节码)(动态构建全新字节码bean初始化的时候)<br>    - cglib(动态构建字节码)(动态构建全新字节码bean初始化的时候)<br>    - Aspectj(修改目标类的字节，织入代理的字节，在程序编译(编译的时候插入动态代理的字节码，不会生成全新的Class)<br>    - instrumentation (修改目标类的字节码、类装载的时候动态拦截去修改,基于javaagent)javaagent:spring-instrument-4.3.8.RELEASE.jar(类装载的时候插入动态代理的字节码，不会生成全新的Class)</p>
<p>以上几种都是对JVM字节码进行操作，但操作方式又有不同。前两种是新增一个完整的Class字节码（必须要用到反射），而后两种是修改现有类的字节码（不需要使用反射）。</p>
<p>静态代理的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br>*目标对象<br>*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> class <span class="hljs-title">Rainbow</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"hello"</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">/**<br>*没有接口，使用cglib的方式（代理对象）<br>*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> class RainbowProxy extends <span class="hljs-title">Rainbow</span><span class="hljs-params">()</span></span>&#123;<br>    Rainbow target;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//插入代理的前置逻辑</span><br>    <span class="hljs-keyword">long</span> begin = System.currentTimeMillis();<br>    <span class="hljs-comment">//需要增强的目标对象的方法</span><br>    target.sayHello();<br>    <span class="hljs-comment">//插入代理的后置逻辑</span><br>    <span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>    System.out.println(end-begin);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>基于jdk的动态代理的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><br><span class="hljs-comment">/**<br> * 目标接口<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-comment">/**<br> * 接口的实现类<br> * 目标对象(也即是需要被增强的)<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">"save running..."</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**<br> * 增强方法<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Advice</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"前置增强逻辑"</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">after</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"后置增强逻辑"</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**<br> * 动态代理<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProxyTest</span> </span>&#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">final</span> Target target = <span class="hljs-keyword">new</span> Target();<span class="hljs-comment">//目标对象</span><br>        <span class="hljs-keyword">final</span> Advice advice = <span class="hljs-keyword">new</span> Advice();<span class="hljs-comment">//获得增强方法的对象</span><br><br>        <span class="hljs-comment">//接收动态生成的代理对象，要用接口对象接收（目标对象与代理对象属于同级，故需要用其共同接口接收）</span><br>        TargetInterface proxy = (TargetInterface) Proxy.newProxyInstance(<br>                target.getClass().getClassLoader(),  <span class="hljs-comment">//目标对象的类加载器</span><br>                target.getClass().getInterfaces(),  <span class="hljs-comment">//目标对象相同的接口字节码对象数组</span><br>                <span class="hljs-keyword">new</span> InvocationHandler() &#123;           <span class="hljs-comment">//调用代理对象的任何方法，实质上执行的都是invoke方法</span><br>        <span class="hljs-comment">//TargetInterface proxy = (TargetInterface) Proxy.newProxyInstance(ProxyTest.class.getClassLoader(), new Class[]&#123;TargetInterface.class&#125;, new InvocationHandler() &#123;</span><br>            <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>                        advice.before();<span class="hljs-comment">//前置增强</span><br>                        <span class="hljs-keyword">try</span> &#123;<br>                            <span class="hljs-keyword">return</span> method.invoke(target, args);<span class="hljs-comment">//target：目标方法，args：实际参数</span><br>                        &#125; <span class="hljs-keyword">finally</span> &#123;<br>                            advice.after();<span class="hljs-comment">//后置增强</span><br>                        &#125;<br>                    &#125;<br>                &#125;);<br>        <span class="hljs-comment">//调用代理对象的方法</span><br>        proxy.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>基于cglib的动态代理的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br> * 目标对象<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">"save running..."</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**<br> * 增强方法<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Advice</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"前置增强逻辑"</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">after</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"后置增强逻辑"</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**<br> * 动态代理<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProxyTest</span> </span>&#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">final</span> Target target = <span class="hljs-keyword">new</span> Target();<span class="hljs-comment">//目标对象</span><br>        <span class="hljs-keyword">final</span> Advice advice = <span class="hljs-keyword">new</span> Advice();<span class="hljs-comment">//获得增强方法的对象</span><br><br>        <span class="hljs-comment">//返回值 就是动态生成的代理对象  基于cglib</span><br>        <span class="hljs-comment">//1、创建增强器</span><br>        Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer();<br>        <span class="hljs-comment">//2、创建父类（目标类）</span><br>        enhancer.setSuperclass(Target<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>        <span class="hljs-comment">//3、设置回调函数</span><br>        enhancer.setCallback(<span class="hljs-keyword">new</span> MethodInterceptor()&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>                advice.before();<span class="hljs-comment">//前置增强</span><br>                Object invoke = method.invoke(target, args);<br>                advice.after();<span class="hljs-comment">//后置增强</span><br>                <span class="hljs-keyword">return</span> invoke;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-comment">//4、生成代理对象</span><br>        Target proxy = (Target) enhancer.create();<br><br><br>        <span class="hljs-comment">//测试</span><br>        proxy.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<h2 id="常用的AOP动态代理技术"><a href="#常用的AOP动态代理技术" class="headerlink" title="常用的AOP动态代理技术"></a>常用的AOP动态代理技术</h2><ul>
<li><strong>JDK代理</strong>:基于接口的动态代理技术。目标对象（需要增强的对象）和动态代理（运行时内存中生产的）实现同一个接口。</li>
<li><strong>cglib代理</strong>:基于父类的动态代理技术</li>
</ul>
<h2 id="AOP相关概念"><a href="#AOP相关概念" class="headerlink" title="AOP相关概念"></a>AOP相关概念</h2><ul>
<li>Target（目标对象）：代理的目标的对象</li>
<li>Proxy（代理）：一个类被AOP织入增强后，就产生一个结果代理类</li>
<li>JoinPoint（连接点）：所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法, 因为spring只支持方法类型的连接点</li>
<li>Pointcut（切入点）：所谓切入点是指我们要对哪些JoinPoint进行拦截的定义（连接点中要被增强的部分）</li>
<li>Advice（通知/增强）：所谓通知是指拦截到JoinPoint之后所要做的事情就是通知</li>
<li>Aspect（切面）：是切点和通知（引介）的结合</li>
<li>Weaving（织入）：是指把增强应用到目标对象来创建新的代理对象的过程。spring采用动态代理织入,而Aspect采用编译期织入和类装载期织入（就是将切点跟通知/增强结合的过程）</li>
</ul>
<h2 id="AOP开发明确的事项"><a href="#AOP开发明确的事项" class="headerlink" title="AOP开发明确的事项"></a>AOP开发明确的事项</h2><ol>
<li><p>需要编写的内容</p>
<ul>
<li>编写核心业务代码（目标类的目标方法）</li>
<li>编写切面类，切面类中有通知（增强功能方法）</li>
<li>在配置文件中，配置织入关系，即将哪些通知与哪些连接点进行结合</li>
</ul>
</li>
<li><p>AOP技术实现的内容</p>
<p> Spring框架监控切入点方法的执行。一旦监控到切入点方法被运行，使用代理机制，动态创建目标对象的代理对象，根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行。</p>
</li>
<li><p>AOP底层使用哪种代理方式</p>
<p> 在spring中,框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式。</p>
</li>
</ol>
<h2 id="AOP配置方式"><a href="#AOP配置方式" class="headerlink" title="AOP配置方式"></a>AOP配置方式</h2><h4 id="xml方式进行配置"><a href="#xml方式进行配置" class="headerlink" title="xml方式进行配置"></a>xml方式进行配置</h4><ul>
<li>导入AOP相关坐标</li>
<li>创建目标接口和目标类(内部有切点)</li>
<li>创建切面类(内部有增强方法)</li>
<li>将目标类和切面类的对象创建权交给spring</li>
<li>在applicationContextxml中配置织入关系</li>
<li>测试代码</li>
</ul>
<ol>
<li>导入坐标（第三方的框架）<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li>
<li>切点表达式<ul>
<li>访问修饰符可以省略</li>
<li>返回值类型、包名、类名、方法名乐意用星号*代表任意</li>
<li>包名与类名之间一个点.代表当前包下的类，两个点.. 表示当前包及其子包下的类</li>
<li>参数列表可以使用两个点..表示任意个数，任意类型的参数列表（方法的参数）</li>
</ul>
</li>
</ol>
<blockquote>
<p>execution([修饰符]返回值类型包名.类名.方法名(参数))</p>
</blockquote>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--top.rainbowcat.aop包下的Target类中的save()无参、无返回值方法--&gt;</span><br>execution(public void top.rainbowcat.aop.Target.save())<br><span class="hljs-comment">&lt;!--top.rainbowcat.aop包下的Target类中的任意无返回值的方法--&gt;</span><br>execution(void top.rainbowcat.aop.Target.*(..))<br><span class="hljs-comment">&lt;!--top.rainbowcat.aop包下的任意类中的任意方法，返回值也不限--&gt;</span><br>execution(* top.rainbowcat.aop.*.*(..))<br><span class="hljs-comment">&lt;!--top.rainbowcat.aop包及其子包下的任意类中的任意方法，返回值也不限--&gt;</span><br>execution(* top.rainbowcat.aop..*.*(..))<br><span class="hljs-comment">&lt;!--任意包中任意类的任意方法--&gt;</span><br>execution(* *..*.*(..))<br></code></pre></div></td></tr></table></figure>
<ol start="3">
<li>通知类型<br>通知的配置语法：<blockquote>
<p>&lt;aop:通知类型 method=”切面类中方法名” pointcut=”切面表达式”&gt;&lt;/aop:通知类型&gt;</p>
</blockquote>
</li>
</ol>
<table>
    <tr>
        <th>名称</th>
        <th>标签</th>
        <th>说明</th>
    </tr>
    <tr>
        <td  align="center">前置通知</td>
        <td  align="center">aop:before</td>
        <td  align="center">用于配置前置通知。指定增强的方法在切入点方法之前执行</td>
    </tr>
    <tr>
        <td  align="center">后置通知</td>
        <td  align="center">aop:after-returning</td>
        <td  align="center">用于配置后置通知。指定增强的方法在切入点方法之后执行</td>
    </tr>
    <tr>
        <td  align="center">环绕通知</td>
        <td  align="center">aop:around</td>
        <td  align="center">用于配置环绕通知。指定增强的方法在切入点方法之前和之后都</td>
    </tr>
    <tr>
        <td  align="center">异常抛出通知</td>
        <td  align="center">aop:throwing</td>
        <td  align="center">用于配置异常抛出通知。指定增强的方法在出现异常时执行</td>
    </tr>
    <tr>
        <td  align="center">最终通知</td>
        <td  align="center">aop:after</td>
        <td  align="center">用于配置最终通知。无论增强方式执行是否有异常都会执行</td>
    </tr>
</table>

<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">/**<br> * 目标接口<br> */<br>public interface TargetInterface &#123;<br>    public void save();<br>&#125;<br><br>/**<br> * 接口的实现类<br> * 目标对象(也即是需要被增强的)<br> */<br>public class Target implements TargetInterface &#123;<br>    @Override<br>    public void save() &#123;<br>        int i = 1/0;//用于测试异常抛出<br>        System.out.println("save running...");<br>    &#125;<br>&#125;<br><br>/**<br> * 切面类<br> */<br>public class MyAspect &#123;<br>    /**<br>     * 前置增强<br>     */<br>    public void before()&#123;<br>        System.out.println("前置增强...");<br>    &#125;<br><br>    /**<br>     * 后置增强<br>     */<br>    public void afterReturning()&#123;<br>        System.out.println("后置增强...");<br>    &#125;<br><br>    /**<br>     * 环绕增强方法<br>     * @param pjp 正在执行的连接点（切点）<br>     * @return<br>     */<br>    public Object around(ProceedingJoinPoint pjp) throws Throwable &#123;<br>        System.out.println("环绕前增强...");<br>        //切点方法<br>        Object proceed = pjp.proceed();<br>        System.out.println("环绕后增强...");<br>        return proceed;<br>    &#125;<br><br>    /**<br>     * 异常抛出增强<br>     */<br>    public void afterThrowing()&#123;<br>        System.out.println("异常抛出增强...");<br>    &#125;<br>    /**<br>     * 最终增强<br>     */<br>    public void after()&#123;<br>        System.out.println("最终增强...");<br>    &#125;<br>&#125;<br><br>/**<br>*测试类<br>*/<br>@RunWith(SpringJUnit4ClassRunner.class)<br>@ContextConfiguration("classpath:applicationContext.xml")<br>public class AopTest &#123;<br>    @Autowired<br>    private TargetInterface target;<br>    @Test<br>    public void Test()&#123;<br>        target.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>XML配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>   <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">"http://www.springframework.org/schema/aop"</span><br>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<br>                    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--配置目标对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"target"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.aop.Target"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置切面对象--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myAspect"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.aop.MyAspect"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--配置织入、告诉spring需要增强的方法和增强功能，首先要引入AOP命名空间--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--声明切面：切点 + 通知--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"myAspect"</span>&gt;</span><span class="hljs-comment">&lt;!--只有在此配置了，切面才能被spring容器获取到--&gt;</span><br>                    <span class="hljs-comment">&lt;!--aop:后面的参数是通知，method当中的是切面类中方法的名字--&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"before"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(public void top.rainbowcat.aop.Target.save())"</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">aop:after-returning</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"afterReturning"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">aop:around</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"around"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">aop:after-throwing</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"afterThrowing"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">aop:after</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"after"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<ol start="4">
<li>切点表达式的抽取<br>当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用pointcut-ref属性代替pointcut属性来引用抽取后的切点表达式。<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--抽取切点表达式--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myPointcut"</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--声明切面：切点 + 通知--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"myAspect"</span>&gt;</span><span class="hljs-comment">&lt;!--只有在此配置了，切面才能被spring容器获取到--&gt;</span><br>            <span class="hljs-comment">&lt;!--aop:后面的参数是通知，method当中的是切面类中方法的名字--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"before"</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">"myPointcut"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">aop:after</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"after"</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">"myPointcut"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

</li>
</ol>
<h4 id="基于注解的AOP开发"><a href="#基于注解的AOP开发" class="headerlink" title="基于注解的AOP开发"></a>基于注解的AOP开发</h4><ol>
<li>开发步骤</li>
</ol>
<ul>
<li>创建目标接口和目标类(内部有切点)</li>
<li>创建切面类(内部有增强方法)</li>
<li>将目标类和切面类的对象创建权交给spring</li>
<li>在切面类中使用注解配置织入关系</li>
<li>在配置文件中开启组件扫描和AOP的自动代理</li>
<li>测试</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">/**<br> * 目标对象<br> */<br>@Component("target")  //添加目标类注解<br>public class Target implements TargetInterface &#123;<br>    @Override<br>    public void save() &#123;<br>        System.out.println("save running...");<br>    &#125;<br>&#125;<br><br>/**<br> * 切面类<br> */<br>@Component("myAspect")  //添加切面类注解<br>@Aspect  //标注myAspect是切面<br>public class MyAspect &#123;<br><br>    @Before("execution(* top.rainbowcat.aop.*.*(..))")//通知类型及切点表达式<br>    public void before()&#123;<br>        System.out.println("前置增强...");<br>    &#125;<br>&#125;<br><br>/**<br>*测试类<br>*/<br>@RunWith(SpringJUnit4ClassRunner.class)<br>@ContextConfiguration("classpath:applicationContext.xml")//在配置文件中要设置：组件扫描、AOP自动代理<br>public class AopTest &#123;<br>    @Autowired<br>    private TargetInterface target;<br>    @Test<br>    public void Test()&#123;<br>        target.save();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">"http://www.springframework.org/schema/aop"</span><br>       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span><br>        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<br>                        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd<br>                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd<br>"</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--配置组件扫描--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"top.rainbowcat"</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!--配置AOP自动代理--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>注解通知的类型<br>通知的配置语法：<blockquote>
<p>@通知注解(“切点表达式”)</p>
</blockquote>
</li>
</ol>
<table>
    <tr>
        <th>名称</th>
        <th>标签</th>
        <th>说明</th>
    </tr>
    <tr>
        <td  align="center">前置通知</td>
        <td  align="center">@Before</td>
        <td  align="center">用于配置前置通知。指定增强的方法在切入点方法之前执行</td>
    </tr>
    <tr>
        <td  align="center">后置通知</td>
        <td  align="center">AfterReturning</td>
        <td  align="center">用于配置后置通知。指定增强的方法在切入点方法之后执行</td>
    </tr>
    <tr>
        <td  align="center">环绕通知</td>
        <td  align="center">@Around</td>
        <td  align="center">用于配置环绕通知。指定增强的方法在切入点方法之前和之后都</td>
    </tr>
    <tr>
        <td  align="center">异常抛出通知</td>
        <td  align="center">@AfterThrowing</td>
        <td  align="center">用于配置异常抛出通知。指定增强的方法在出现异常时执行</td>
    </tr>
    <tr>
        <td  align="center">最终通知</td>
        <td  align="center">@After</td>
        <td  align="center">用于配置最终通知。无论增强方式执行是否有异常都会执行</td>
    </tr>
</table>

<ol start="3">
<li>切点表达式抽取<br>同xml配置aop一样，我们可以将切点表达式抽取。抽取方式是在切面内定义方法,在该方法上使用@Pointcut注解定义切点表达式，然后在在增强注解中进行引用。<br><br>具体如下:<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br> * 切面类<br> */</span><br><span class="hljs-meta">@Component</span>(<span class="hljs-string">"myAspect"</span>)  <span class="hljs-comment">//添加切面类注解</span><br><span class="hljs-meta">@Aspect</span>  <span class="hljs-comment">//标注myAspect是切面</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br><br>    <span class="hljs-comment">/**<br>     * 定义切点表达式<br>     */</span><br>    <span class="hljs-meta">@Pointcut</span>(<span class="hljs-string">"execution(* top.rainbowcat.aop.*.*(..))"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pointcut</span><span class="hljs-params">()</span></span>&#123;&#125;<br><br>    <span class="hljs-meta">@Before</span>(<span class="hljs-string">"pointcut()"</span>)<span class="hljs-comment">//引用方式一</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"前置增强..."</span>);<br>    &#125;<br>    <span class="hljs-meta">@AfterReturning</span>(<span class="hljs-string">"MyAspect.pointcut()"</span>)<span class="hljs-comment">//引用方式二</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterReturning</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">"后置增强..."</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

</li>
</ol>
<h1 id="Spring-JdbcTemplate基本使用"><a href="#Spring-JdbcTemplate基本使用" class="headerlink" title="Spring JdbcTemplate基本使用"></a>Spring JdbcTemplate基本使用</h1><h2 id="JdbcTemplate概述"><a href="#JdbcTemplate概述" class="headerlink" title="JdbcTemplate概述"></a>JdbcTemplate概述</h2><p>它是spring框架中提供的一个对象，是对原始繁琐的Jdbc API对象的简单封装。spring框架为我们提供了很多的操作模板类。例如:操作关系型数据的JdbcTemplate和ibernateTemplate,操作nosq|数据库的RedisTemplate,操作消息队列的Jms Template等等。</p>
<h2 id="JdbcTemplate开发步骤"><a href="#JdbcTemplate开发步骤" class="headerlink" title="JdbcTemplate开发步骤"></a>JdbcTemplate开发步骤</h2><ul>
<li>导入spring-jdbc和spring-tx坐标</li>
<li>创建数据库表和实体</li>
<li>创建JdbcTemplate对象</li>
<li>执行数据库操作</li>
</ul>
<p>首先要导入相应坐标：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br> * xml配置方式，测试JdbcTemplate<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateTest</span> </span>&#123;<br><br>    <span class="hljs-comment">/**<br>     * 不使用容器,直接创建<br>     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test1</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//创建数据源对象</span><br>        DruidDataSource dataSource = <span class="hljs-keyword">new</span> DruidDataSource();<br>        dataSource.setDriverClassName(<span class="hljs-string">"com.mysql.jdbc.Driver"</span>);<br>        dataSource.setUrl(<span class="hljs-string">"jdbc:mysql:///rainbowcat?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;serverTimezone=GMT&amp;allowPublicKeyRetrieval=true"</span>);<br>        dataSource.setUsername(<span class="hljs-string">"root"</span>);<br>        dataSource.setPassword(<span class="hljs-string">"dong123"</span>);<br><br>        JdbcTemplate template = <span class="hljs-keyword">new</span> JdbcTemplate();<br>        <span class="hljs-comment">//在使用前须设置数据源</span><br>        template.setDataSource(dataSource);<br>        String sql = <span class="hljs-string">"select * from userinfo"</span>;<br>        List&lt;UserInfo&gt; infos = template.query(sql, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;UserInfo&gt;(UserInfo<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;<br>        System.out.println(infos);<br>    &#125;<br><br>    <span class="hljs-comment">/**<br>     *使用spring容器<br>     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test2</span><span class="hljs-params">()</span></span>&#123;<br>        ApplicationContext app = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"applicationContext.xml"</span>);<br>        JdbcTemplate template = app.getBean(JdbcTemplate<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>        String sql = <span class="hljs-string">"select * from userinfo"</span>;<br>        List&lt;UserInfo&gt; infos = template.query(sql, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;UserInfo&gt;(UserInfo<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;<br>        System.out.println(infos);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--加载外部配置文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"classpath:jdbc.properties"</span> /&gt;</span><br><span class="hljs-comment">&lt;!--配置数据源对象--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.drive&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.url&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.username&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.password&#125;"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--jdbc模板对象--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"template"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>使用注解进行测试，以及CRUD使用：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">@RunWith(SpringJUnit4ClassRunner.class)<br>@ContextConfiguration("classpath:applicationContext.xml")<br>public class JdbcDRUDTest &#123;<br>    @Autowired<br>    private JdbcTemplate template;<br><br>    @Test<br>    public void testInsert()&#123;<br>        template.update("insert into userinfo value (?, ?, ?, ?, ?, ?, ?)", "admin", "123", "管理员", "男", "admin", "12345678900", "admin@qq.com");<br>    &#125;<br><br>    @Test<br>    public void testUpdate()&#123;<br>        template.update("update userinfo set email = ? where username = ?", "1029322685@qq.com", "admin");<br>    &#125;<br><br>    @Test<br>    public void testDelete()&#123;<br>        template.update("delete  from userinfo where username = ?", "admin");<br>    &#125;<br><br>    @Test<br>    public void testQueryAll()&#123;<br>        List&lt;UserInfo&gt; infos = template.query("select * from userinfo", new BeanPropertyRowMapper&lt;UserInfo&gt;(UserInfo.class));<br>        System.out.println(infos);<br>    &#125;<br><br>    @Test<br>    public void testQueryOne()&#123;<br>        UserInfo userInfo = template.queryForObject("select * from userinfo where username = ?", new BeanPropertyRowMapper&lt;UserInfo&gt;(UserInfo.class), "root");<br>        System.out.println(userInfo);<br>    &#125;<br>    <br>    @Test<br>    public void testQueryCount()&#123;<br>        Integer count = template.queryForObject("select count(*) from userinfo", Integer.class);<br>        System.out.println(count);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="Spring的事务控制"><a href="#Spring的事务控制" class="headerlink" title="Spring的事务控制"></a>Spring的事务控制</h1><h2 id="编程式事务控制"><a href="#编程式事务控制" class="headerlink" title="编程式事务控制"></a>编程式事务控制</h2><ol>
<li>PlatformTransactionManager<br>PlatformTransactionManager接口是spring的事务管理器，它里面提供了我们常用的操作事务的方法。<table>
 <tr>
     <th>方法</th>
     <th>说明</th>
 </tr>
 <tr>
     <td  align="center">TransactionStatus getTransaction (TransactionDefinition definition)</td>
     <td  align="center">获取事务的状态信息</td>
 </tr>
 <tr>
     <td  align="center">void commit (TransactionStatus status)</td>
     <td  align="center">提交事务</td>
 </tr>
 <tr>
     <td  align="center">void rollback (TransactionStatus status)</td>
     <td  align="center">回滚事务</td>
 </tr>
</table>

</li>
</ol>
<p><strong>注意：</strong><br>PlatformTransactionManager是接口类型，不同的Dao层技术则有不同的实现类例如: </p>
<ul>
<li>Dao 层技术是jdbc或mybatis时: org.springframework.jdbc.datasource.DataSourceTransactionManager。</li>
<li>Dao层技术是hibernate时: org.springframework.orm.hibernate5.HibernateTransactionManager。</li>
</ul>
<ol start="2">
<li><p>TransactionDefinition<br>TransactionDefinition是事务的定义信息对象，里面有如下方法:</p>
<table>
 <tr>
     <th>方法</th>
     <th>说明</th>
     <th></th>
 </tr>
 <tr>
     <td>int getIsolationLevel ()</td>
     <td  align="center">获得事务的隔离级别<br>（设置隔离级别，可以解决事务并发产生的问题，如脏读、不可重复读和虚读。）</td>
     <td  align="center">
         ISOLATION_DEFAULT：默认的<br>
         ISOLATION_READ_ UNCOMMITTED：哪种都不能解决<br>
         ISOLATION_READ_COMMITTED：解决脏读<br>
         ISOLATION_REPEATABLE_READ：解决不可重复读<br>
         ISOLATION_SERIALIZABLE：全都能解决（性能较低）<br>
     </td>
 </tr>
 <tr>
     <td>int getPropagationBehavior ()</td>
     <td  align="center">获得事务的传播行为<br>（解决业务方法调用业务方法时，事务同一性问题）</td>
     <td  align="center"></td>
 </tr>
 <tr>
     <td>int getTimeout ()</td>
     <td  align="center">获得超时时间</td>
     <td  align="center">
         REQUIRED:如果当前没有事务，就新建-个事务，如果已经存在一个事务中，加入到这个事务中。-般的选择(默认值)。<br>
         SUPPORTS:支持当前事务,如果当前没有事务,就以非事务方式执行(没有事务)。<br>
         MANDATORY:使用当前的事务，如果当前没有事务，就抛出异常。<br>
         REQUERS_NEW:新建事务，如果当前在事务中，把当前事务挂起。<br>
         NOT_SUPPORTED:以非事务方式执行操作,如果当前存在事务，就把当前事务挂起。<br>
         NEVER:以非事务方式运行，如果当前存在事务，抛出异常。<br>
         NESTED:如果当前存在事务，则在嵌套事务内执行。如果当前没有事务,则执行REQUIRED类似的操作。<br>
         超时时间：默认值是-1,没有超时限制。如果有，以秒为单位进行设置。<br>
         是否只读：建议查询时设置为只读。<br>
     </td>
 </tr>
 <tr>
     <td>boolean isReadonly ()</td>
     <td  align="center">是否只读</td>
     <td  align="center"></td>
 </tr>
</table>
</li>
<li><p>TransactionStatus<br>TransactionStatus接口提供的是事务具体的运行状态，方法介绍如下。</p>
<table>
 <tr>
     <th>方法</th>
     <th>说明</th>
 </tr>
 <tr>
     <td>boolean hasSavepoint()</td>
     <td  align="center">是否存储回滚点</td>
 </tr>
 <tr>
     <td>boolean isCompleted()</td>
     <td  align="center">事务是否完成</td>
 </tr>
 <tr>
     <td>boolean isNewTransaction ()</td>
     <td  align="center">是否是新事务</td>
 </tr>
 <tr>
     <td>boolean isRollbackOnly ()</td>
     <td  align="center">事务是否回滚</td>
 </tr>
</table>

</li>
</ol>
<h2 id="声明式事务控制"><a href="#声明式事务控制" class="headerlink" title="声明式事务控制"></a>声明式事务控制</h2><p>Spring的声明式事务顾名思义就是采用声明的方式来处理事务。这里所说的声明，就是指在配置文件中声明,用在Spring配置文件中声明式的处理事务来代替代码式的处理事务。<br><br><strong>声明式事务处理的作用：</strong></p>
<ul>
<li>事务管理不侵入开发的组件。具体来说，业务逻辑对象就不会意识到正在事务管理之中，事实上也应该如此，因为事务管理是属于系统层面的服务,而不是业务逻辑的一部分，如果想要改变事务管理策划的话，也只需要在定义文件中重新配置即可。</li>
<li>在不需要事务管理的时候,只要在设定文件上修改一下,即可移去事务管理服务,无需改变代码重新编译，这样维护起来极其方便</li>
</ul>
<p><strong>注意:</strong> Spring声明式事务控制底层就是AOP。</p>
<h4 id="基于XML的声明式事务控制"><a href="#基于XML的声明式事务控制" class="headerlink" title="基于XML的声明式事务控制"></a>基于XML的声明式事务控制</h4><p>需要明确以下几点：</p>
<ul>
<li>谁是切点</li>
<li>谁是通知</li>
<li>配置切面</li>
</ul>
<p>声明式事务控制的配置要点：</p>
<ul>
<li>平台事务管理器配置</li>
<li>事务通知的配置</li>
<li>事务aop织入的配置</li>
</ul>
<p>切点方法的事务参数配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"txAdvice"</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">"transactionManager"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"*"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br></code></pre></div></td></tr></table></figure>
<p>其中，&lt;tx:method&gt;代表切点方法的事务参数的配置,例如:<br><br>&lt;tx:method name=”transfer” isolation=”DEFAULT” propagation=”REQUIRED” timeout=”-1” read-only=”false”/&gt;</p>
<ul>
<li>name：切点方法名</li>
<li>isolation：事务的隔离级别</li>
<li>propagation：事务的传播行为</li>
<li>timeout：超时时间</li>
<li>read-only：是否只读</li>
</ul>
<p>示例（转账，基于XML实现）：<br></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">/**<br> * Dao层<br> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccountDao</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> JdbcTemplate template;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTemplate</span><span class="hljs-params">(JdbcTemplate template)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.template = template;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">out</span><span class="hljs-params">(String outMan, Double money)</span> </span>&#123;<br>        template.update(<span class="hljs-string">"update account set money = money-? where name = ?"</span>, money, outMan);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">in</span><span class="hljs-params">(String inMan, Double money)</span> </span>&#123;<br>        template.update(<span class="hljs-string">"update account set money = money+? where name = ?"</span>, money, inMan);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**<br>*目标对象，包含切点<br>*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountServiceImp</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccountService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> AccountDao accountDao;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAccountDao</span><span class="hljs-params">(AccountDao accountDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.accountDao = accountDao;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(String outMan, String inMan, Double money)</span> </span>&#123;<br>        accountDao.out(outMan, money);<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;  <span class="hljs-comment">//用于测试事务是否起作用</span><br>        accountDao.in(inMan, money);<br>    &#125;<br>&#125;<br><span class="hljs-comment">/**<br>*模拟前端逻辑<br>*/</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountController</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ApplicationContext app = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"applicationContext.xml"</span>);<br>        AccountService accountService = app.getBean(AccountService<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>        accountService.transfer(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"tom"</span>, <span class="hljs-number">200.00</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span><br>       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span><br>       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">"http://www.springframework.org/schema/aop"</span><br>       <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">"http://www.springframework.org/schema/tx"</span><br>       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span><br>        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<br>                        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd<br>                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd<br>                        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd<br>"</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--加载外部配置文件--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"classpath:jdbc.properties"</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!--配置数据源对象--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.drive&#125;"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.url&#125;"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.username&#125;"</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.password&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--jdbc模板对象--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"template"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--下面是事务相关配置--&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"accountDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.dao.Impl.AccountDaoImpl"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"template"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"template"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--目标对象 内部的方法即是切点--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"accountService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top.rainbowcat.service.Impl.AccountServiceImp"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accountDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"accountDao"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--配置平台事务管理器--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"transactionManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--事务是通过connection起作用，connection是从datasource获取的--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--通知 事务的增强--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"txAdvice"</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">"transactionManager"</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--设置事务属性的参数信息--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!--name：需要被增强的切点，这里可以配置多个事务并且可分别设置参数--&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"*"</span>/&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"transfer"</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">"DEFAULT"</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">"REQUIRED"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"-1"</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">"false"</span>/&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--配置事务的AOP织入--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">"txAdvice"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"execution(* top.rainbowcat.service.Impl.*.*(..))"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:advisor</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h4 id="基于注解的声明式事务控制"><a href="#基于注解的声明式事务控制" class="headerlink" title="基于注解的声明式事务控制"></a>基于注解的声明式事务控制</h4><p>除了对相应的bean添加注解，还需要在要执行事务的方法当中进行配置：</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>(<span class="hljs-string">"accountService"</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountServiceImp</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccountService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountDao accountDao;<br><br>    <span class="hljs-comment">//  此处的配置相当于  &lt;tx:method name="transfer" isolation="DEFAULT" propagation="REQUIRED" timeout="-1" read-only="false"/&gt;</span><br>    <span class="hljs-comment">//  也可配置到类名的上方，相当于  &lt;tx:method name="*"/&gt;</span><br>    <span class="hljs-comment">//  还需要在xml当中配置注解驱动</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-keyword">false</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(String outMan, String inMan, Double money)</span> </span>&#123;<br>        accountDao.out(outMan, money);<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;  <span class="hljs-comment">//用于测试事务是否起作用</span><br>        accountDao.in(inMan, money);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>XML配置文件当中，必须要添加注解驱动才能完成事务的控制！！！</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--配置组件扫描--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"top.rainbowcat"</span> /&gt;</span><br><br><span class="hljs-comment">&lt;!--加载外部配置文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"classpath:jdbc.properties"</span> /&gt;</span><br><span class="hljs-comment">&lt;!--配置数据源对象--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.drive&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.url&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.username&#125;"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;jdbc.password&#125;"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--jdbc模板对象--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"template"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--下面是事务相关配置--&gt;</span><br><br><span class="hljs-comment">&lt;!--配置平台事务管理器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"transactionManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--事务是通过connection起作用，connection是从datasource获取的--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--事务的注解驱动--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">"transactionManager"</span> /&gt;</span><br></code></pre></div></td></tr></table></figure>
<ul>
<li>注解配置声明式事务控制解析<ul>
<li>使用@Transactional在需要进行事务控制的类或是方法上修饰,注解可用的属性同xml配置方式，例如隔离级别、传播行为等。</li>
<li>注解使用在类上，那么该类下的所有方法都使用同一套注解参数配置。</li>
<li>使用在方法上,不同的方法可以采用不同的事务参数配置。</li>
<li>Xml配置文件中要开启事务的注解驱动&lt;tx:annotation-driven /&gt;</li>
</ul>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Spring/">Spring</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/07/30/Spring%20MVC/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring MVC</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/07/24/Maven%E4%BD%BF%E7%94%A8tomcat8%E6%8F%92%E4%BB%B6/">
                        <span class="hidden-mobile">Maven使用tomcat插件</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
